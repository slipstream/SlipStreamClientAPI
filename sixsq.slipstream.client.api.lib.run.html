<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><title>sixsq.slipstream.client.api.lib.run documentation</title></head><body><header><section class="title"><h1><a href="index.html">SlipStream Client API Api Documentation</a></h1></section><small>Version: 3.1-SNAPSHOT</small></header><section class="container"><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sixsq</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>slipstream</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></div></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></div></li><li class="depth-5 branch"><a href="sixsq.slipstream.client.api.cimi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cimi</span></div></a></li><li class="depth-5"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lib</span></div></div></li><li class="depth-6 current"><a href="sixsq.slipstream.client.api.lib.run.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>run</span></div></a></li><li class="depth-5 branch"><a href="sixsq.slipstream.client.api.run.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>run</span></div></a></li><li class="depth-5"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></div></li><li class="depth-6 branch"><a href="sixsq.slipstream.client.api.utils.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-6 branch"><a href="sixsq.slipstream.client.api.utils.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-6 branch"><a href="sixsq.slipstream.client.api.utils.http-async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http-async</span></div></a></li><li class="depth-6 branch"><a href="sixsq.slipstream.client.api.utils.path.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>path</span></div></a></li><li class="depth-6"><a href="sixsq.slipstream.client.api.utils.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><section class="namespace-docs" id="content"><h2 class="anchor" id="top">sixsq.slipstream.client.api.lib.run</h2><div class="doc"><div class="markdown"><h1>Purpose</h1><p>The <code>run</code> namespace contains functions for interacting with SlipStream runs.</p><p>It allows users to</p>
<ul>
  <li>Scale the components of the running application up and down,</li>
  <li>Query the state of the run,</li>
  <li>Query and set parameters of the application components and their instances,</li>
  <li>Query parameters from global namespace (<code>ss:</code>), and</li>
  <li>Terminate the run.</li>
</ul><p>Timeouts and intervals are in seconds.</p><h1>SlipStraem run termininology</h1><p>There are three types of parameters on a run</p>
<ul>
  <li>Global parameter - <code>ss:tags</code></li>
  <li>Application component parameter - <code>webapp:ids</code></li>
  <li>Application component instance parameter - <code>webapp.1:hostname</code></li>
</ul><p>where</p>
<ul>
  <li><code>ss</code> is the global namespace of the run,</li>
  <li><code>webapp</code> is the name of the application component, which is refered to as <code>comp</code>  in the API,</li>
  <li><code>webapp.1</code> is the name of the instance <code>1</code> of the application component <code>webapp</code>.</li>
</ul><h1>Usage and examples</h1>
<pre><code>(require &#39;[com.sixsq.slipstream.clj-client.lib.run :as r])

(def context {:username &quot;foo&quot;
              :password &quot;bar&quot;})
(r/with-new-context context (r/get-run-info &quot;123-456&quot;))

;;
;; Change context and query a number of runs.
(def my-slipstream {:serviceurl &quot;https://example.com&quot;
                    :username &quot;jay&quot;
                    :password &quot;random&quot;})
(def runs [&quot;253194ea-f982-4e1e-881e-7642408eae21&quot;
           &quot;b0271dff-773e-4f4b-9915-c3cd3ec8bcb0&quot;
           &quot;253194ea-f982-4e1e-881e-7642408eae21&quot;])
(for [run-uuid runs]
  (r/with-new-context my-slipstream (r/get-run-info run-uuid)))
</code></pre></div></div><div class="public anchor" id="var-*context*"><h3><a href="#var-*context*">*context*</a></h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-aborted.3F"><h3><a href="#var-aborted.3F">aborted?</a></h3><div class="usage"><code>(aborted? run-uuid)</code></div><div class="doc"><div class="markdown"><p>Check if run is in &lsquo;Aborted&rsquo; state.</p></div></div></div><div class="public anchor" id="var-action-failure"><h3><a href="#var-action-failure">action-failure</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-action-result"><h3><a href="#var-action-result">action-result</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-action-scale-down-at"><h3><a href="#var-action-scale-down-at">action-scale-down-at</a></h3><div class="usage"><code>(action-scale-down-at run-uuid comp ids &amp; [&amp; {:keys [timeout], :or {timeout wait-timeout-default}}])</code></div><div class="doc"><div class="markdown"><p>Scale down application component &lsquo;comp&rsquo; by terminating the component instances identified by IDs in &lsquo;ids&rsquo;. Wait for the completion of the action.</p></div></div></div><div class="public anchor" id="var-action-scale-down-by"><h3><a href="#var-action-scale-down-by">action-scale-down-by</a></h3><div class="usage"><code>(action-scale-down-by run-uuid comp n &amp; [&amp; {:keys [timeout], :or {timeout wait-timeout-default}}])</code></div><div class="doc"><div class="markdown"><p>Scale down application component &lsquo;comp&rsquo; by &lsquo;n&rsquo; instances. Wait for the completion of the action.</p></div></div></div><div class="public anchor" id="var-action-scale-up"><h3><a href="#var-action-scale-up">action-scale-up</a></h3><div class="usage"><code>(action-scale-up run-uuid comp n &amp; [&amp; {:keys [params timeout], :or {params {}, timeout wait-timeout-default}}])</code></div><div class="doc"><div class="markdown"><p>Scale application component &lsquo;comp&rsquo; by &lsquo;n&rsquo; instances up. Wait for the completion of the action. Optionally provide map of parameters as &lsquo;params&rsquo;.</p></div></div></div><div class="public anchor" id="var-action-success"><h3><a href="#var-action-success">action-success</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-action-success.3F"><h3><a href="#var-action-success.3F">action-success?</a></h3><div class="usage"><code>(action-success? result)</code></div><div class="doc"><div class="markdown"><p>Given the &lsquo;result&rsquo; returned by an action, check if it was successfull.</p></div></div></div><div class="public anchor" id="var-can-scale.3F"><h3><a href="#var-can-scale.3F">can-scale?</a></h3><div class="usage"><code>(can-scale? run-uuid)</code></div><div class="doc"><div class="markdown"><p>Check if it&rsquo;s possible to scale the run.</p></div></div></div><div class="public anchor" id="var-cancel-abort"><h3><a href="#var-cancel-abort">cancel-abort</a></h3><div class="usage"><code>(cancel-abort run-uuid)</code></div><div class="doc"><div class="markdown"><p>Cancel abort on the run.</p></div></div></div><div class="public anchor" id="var-default-context"><h3><a href="#var-default-context">default-context</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-get-abort"><h3><a href="#var-get-abort">get-abort</a></h3><div class="usage"><code>(get-abort run-uuid)</code></div><div class="doc"><div class="markdown"><p>Get abort message.</p></div></div></div><div class="public anchor" id="var-get-comp-ids"><h3><a href="#var-get-comp-ids">get-comp-ids</a></h3><div class="usage"><code>(get-comp-ids run-uuid comp)</code></div><div class="doc"><div class="markdown"><p>Get list of instance IDs of application component &lsquo;comp&rsquo;.</p></div></div></div><div class="public anchor" id="var-get-multiplicity"><h3><a href="#var-get-multiplicity">get-multiplicity</a></h3><div class="usage"><code>(get-multiplicity run-uuid comp)</code></div><div class="doc"><div class="markdown"><p>Get multiplicity of application component &lsquo;comp&rsquo;.</p></div></div></div><div class="public anchor" id="var-get-param"><h3><a href="#var-get-param">get-param</a></h3><div class="usage"><code>(get-param run-uuid comp id param &amp; [req])</code></div><div class="doc"><div class="markdown"><p>Get parameter &lsquo;param&rsquo; of application component instance &lsquo;comp.id&rsquo; in run <code>run-uuid</code> as &lsquo;run-uuid/comp.id:param&rsquo;. When &lsquo;id&rsquo; is nil, gets parameter of the application component as &lsquo;run-uuid/comp:param&rsquo;.</p></div></div></div><div class="public anchor" id="var-get-run-info"><h3><a href="#var-get-run-info">get-run-info</a></h3><div class="usage"><code>(get-run-info run-uuid)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-get-scale-state"><h3><a href="#var-get-scale-state">get-scale-state</a></h3><div class="usage"><code>(get-scale-state run-uuid comp id)</code></div><div class="doc"><div class="markdown"><p>Get scale state of the component instance.</p></div></div></div><div class="public anchor" id="var-get-state"><h3><a href="#var-get-state">get-state</a></h3><div class="usage"><code>(get-state run-uuid)</code></div><div class="doc"><div class="markdown"><p>Get state of the run.</p></div></div></div><div class="public anchor" id="var-scalable.3F"><h3><a href="#var-scalable.3F">scalable?</a></h3><div class="usage"><code>(scalable? run-uuid)</code></div><div class="doc"><div class="markdown"><p>Check if run is scalable.</p></div></div></div><div class="public anchor" id="var-scale-down"><h3><a href="#var-scale-down">scale-down</a></h3><div class="usage"><code>(scale-down run-uuid comp ids)</code></div><div class="doc"><div class="markdown"><p>Scale down application component &lsquo;comp&rsquo; by terminating instances defined by &lsquo;ids&rsquo; vector.</p></div></div></div><div class="public anchor" id="var-scale-up"><h3><a href="#var-scale-up">scale-up</a></h3><div class="usage"><code>(scale-up run-uuid comp n)</code><code>(scale-up run-uuid comp n params)</code></div><div class="doc"><div class="markdown"><p>Scale up application component &lsquo;comp&rsquo; by &lsquo;n&rsquo; instances. Allow to set parameters from &lsquo;params&rsquo; map on the new component instances. Returns list of added component instance names qualified with IDs.</p></div></div></div><div class="public anchor" id="var-select-context"><h3><a href="#var-select-context">select-context</a></h3><div class="usage"><code>(select-context context)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-set-param"><h3><a href="#var-set-param">set-param</a></h3><div class="usage"><code>(set-param run-uuid comp id param value &amp; [req])</code></div><div class="doc"><div class="markdown"><p>Set parameter &lsquo;param&rsquo; to &lsquo;value&rsquo; on application component instance &lsquo;comp.id&rsquo;.</p></div></div></div><div class="public anchor" id="var-set-params"><h3><a href="#var-set-params">set-params</a></h3><div class="usage"><code>(set-params run-uuid comp id params &amp; [req])</code></div><div class="doc"><div class="markdown"><p>Given a map of parameters &lsquo;params&rsquo;, set them on application component instance &lsquo;run-uuid/comp.id&rsquo;.</p></div></div></div><div class="public anchor" id="var-set-run-context.21"><h3><a href="#var-set-run-context.21">set-run-context!</a></h3><div class="usage"><code>(set-run-context! context)</code></div><div class="doc"><div class="markdown"><p>The following map is expected</p>
<pre><code>{:serviceurl &quot;https://nuv.la&quot;

 :cookie       nil

 :username     nil
 :password     nil}
</code></pre><p>If <code>:cookie</code> is provided it&rsquo;s preferred over the <code>:username</code>/<code>:password</code>.</p></div></div></div><div class="public anchor" id="var-take-last-n-ids"><h3><a href="#var-take-last-n-ids">take-last-n-ids</a></h3><div class="usage"><code>(take-last-n-ids run-uuid comp n)</code></div><div class="doc"><div class="markdown"><p>Returns the last &lsquo;n&rsquo; IDs of the currently running instances of application component &lsquo;comp&rsquo;.</p></div></div></div><div class="public anchor" id="var-terminate"><h3><a href="#var-terminate">terminate</a></h3><div class="usage"><code>(terminate run-uuid)</code></div><div class="doc"><div class="markdown"><p>Terminate the run.</p></div></div></div><div class="public anchor" id="var-wait-ready"><h3><a href="#var-wait-ready">wait-ready</a></h3><div class="usage"><code>(wait-ready run-uuid)</code><code>(wait-ready run-uuid timeout)</code></div><div class="doc"><div class="markdown"><p>Waits for Ready state on the run. Returns true on success.</p></div></div></div><div class="public anchor" id="var-wait-timeout-default"><h3><a href="#var-wait-timeout-default">wait-timeout-default</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-with-new-context"><h3><a href="#var-with-new-context">with-new-context</a></h3><h4 class="type">macro</h4><div class="usage"><code>(with-new-context context &amp; body)</code></div><div class="doc"><div class="markdown"></div></div></div></section></section></body></html>